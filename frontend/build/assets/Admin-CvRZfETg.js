import{H as M,a0 as _,s as z,ap as $,u as P,w as Y,t as G,x as H,bD as K,aq as X,r as Q,j as e,G as o,as as w,B as r,aZ as B,aW as W,aX as Z,aY as J,A as j,a7 as A,a9 as V,a$ as k,z as C}from"./index-0gfsL0uy.js";import{u as ee}from"./useOrgRequests-DCbjQvsz.js";import{u as se}from"./useUserOrgs-DlFtn3d9.js";import{B as N}from"./building-DZ038TzP.js";import{L as h}from"./lightbulb-CYO_OQNk.js";import{A as E}from"./arrow-right-BC_qDo43.js";import{C as ae}from"./circle-x-hZWeZhfD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=M("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function re(i){return _({queryKey:["org-analytics",i],queryFn:async()=>{if(!i)return null;const{data:d,error:n}=await z.from("view_business_org_analytics").select("*").eq("org_id",i).single();if(n)throw console.error("Error fetching org analytics:",n),n;return d},enabled:!!i})}function ie({orgId:i,limit:d=10,sortBy:n="u_score"}){return _({queryKey:["org-top-insights",i,d,n],queryFn:async()=>{if(!i)return[];let a=z.from("view_business_insight_analytics").select("*").eq("org_id",i);switch(n){case"u_score":a=a.order("u_score_avg",{ascending:!1}).order("u_score_count",{ascending:!1});break;case"continuations":a=a.order("continuations_count",{ascending:!1});break;case"crosslinks":a=a.order("crosslinks_count",{ascending:!1});break;case"recent":a=a.order("published_at",{ascending:!1});break}a=a.limit(d);const{data:l,error:c}=await a;if(c)throw console.error("Error fetching top insights:",c),c;return l},enabled:!!i})}function he(){$();const{user:i,loading:d}=P(),{isAdmin:n,loading:a}=Y(),l=G(),{data:c}=H(),{isBusinessMember:S}=K(),{isOrgOwner:p}=X(),[t,m]=Q.useState("u_score"),u=n(),F=u||S,L=d||a,{data:x,isLoading:D}=re(c),{data:g,isLoading:R}=ie({orgId:c,limit:10,sortBy:t}),{requests:v,loading:f,approveRequest:O,rejectRequest:U,refetch:q}=ee(),{data:b,isLoading:I}=se();if(L)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})]})});if(!i)return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-primary/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-primary/10 rounded-full blur-3xl"}),e.jsxs(o,{className:"max-w-md w-full",padding:"lg",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(w,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground",children:"Please sign in to access the admin panel"})]}),e.jsx(r,{onClick:()=>l("/auth"),className:"w-full",children:"Sign In"})]})]});if(!F)return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-destructive/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-destructive/10 rounded-full blur-3xl"}),e.jsxs(o,{className:"max-w-md w-full",padding:"lg",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(w,{className:"w-16 h-16 text-destructive mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You must be an admin or business member to access this page"})]}),e.jsx(r,{onClick:()=>l("/"),variant:"outline",className:"w-full",children:"Return Home"})]})]});const y=D||R;return e.jsx("div",{className:"min-h-screen p-6 relative overflow-hidden",style:{background:"#EAE6E2"},children:e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto pt-20 pb-24 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-12",children:[e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4 text-[#3A3530]",children:"Business Admin Panel"}),e.jsx("p",{className:"text-[#6B635B]",children:"Analytics dashboard for your organization"})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>l("/business-settings"),className:"text-[#3A3530] border-[#D4CEC5] hover:bg-[#F5F1ED]",style:{background:"#EAE6E2",boxShadow:"4px 4px 10px rgba(166, 150, 130, 0.2), -4px -4px 10px rgba(255, 255, 255, 0.6)"},children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Business Settings"]})]}),b&&b.length>0&&e.jsxs(o,{className:"border-0",padding:"lg",style:{background:"#EAE6E2",boxShadow:"8px 8px 20px rgba(166, 150, 130, 0.3), -8px -8px 20px rgba(255, 255, 255, 0.85)",borderRadius:"24px"},children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#3A3530] mb-2",children:"My Organizations"}),e.jsx("p",{className:"text-[#6B635B]",children:"All organizations you're a member of"})]}),I?e.jsx("div",{className:"text-center py-8 text-[#6B635B]",children:"Loading organizations..."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(s=>e.jsx("div",{onClick:()=>l(`/business-settings?org=${s.id}`),className:"p-4 rounded-xl cursor-pointer transition-all hover:scale-[1.02]",style:{background:"#F5F1ED",boxShadow:"inset 2px 2px 5px rgba(166, 150, 130, 0.2), inset -2px -2px 5px rgba(255, 255, 255, 0.6)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(W,{className:"h-12 w-12 rounded-lg",children:[e.jsx(Z,{src:s.logo_url||void 0}),e.jsx(J,{className:"bg-primary/10 text-primary rounded-lg",children:s.name.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-[#3A3530] truncate",children:s.name}),e.jsx(j,{variant:"secondary",className:`text-xs ${s.role==="owner"?"bg-primary/20 text-primary border-primary/30":"bg-[#D4CEC5]/50 text-[#6B635B]"}`,children:s.role==="owner"?"Owner":s.role==="business_admin"?"Admin":"Member"})]}),s.description&&e.jsx("p",{className:"text-sm text-[#6B635B] line-clamp-2",children:s.description}),e.jsxs(r,{variant:"ghost",size:"sm",className:"mt-2 text-xs text-[#3A3530] hover:text-[#3A3530] hover:bg-[#EAE6E2]",onClick:T=>{T.stopPropagation(),l(`/business-settings?org=${s.id}`)},children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Settings"]})]})]})},s.id))})]}),e.jsxs(o,{className:"border-0",padding:"lg",style:{background:"#EAE6E2",boxShadow:"8px 8px 20px rgba(166, 150, 130, 0.3), -8px -8px 20px rgba(255, 255, 255, 0.85)",borderRadius:"24px"},children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-[#3A3530]",children:"Organization Snapshot"}),p&&e.jsx(j,{variant:"default",className:"bg-primary text-white border-primary/30",children:"Owner"}),u&&!p&&e.jsx(j,{variant:"secondary",className:"bg-[#D4CEC5]/50 text-[#6B635B]",children:"Admin"})]}),p&&e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>l("/org/new"),className:"text-xs text-[#3A3530] border-[#D4CEC5] hover:bg-[#F5F1ED] hover:text-[#3A3530]",style:{boxShadow:"4px 4px 8px rgba(166, 150, 130, 0.2), -4px -4px 8px rgba(255, 255, 255, 0.6)"},children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"Create Another Organization"]})]}),e.jsx("p",{className:"text-[#6B635B]",children:x?.org_name||"Your Organization"})]}),y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"w-16 h-16 text-primary animate-pulse mx-auto mb-4"}),e.jsx("p",{className:"text-[#6B635B]",children:"Loading analytics..."})]}):c?x?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 rounded-2xl bg-primary/10 flex items-center justify-center",children:e.jsx(h,{className:"w-8 h-8 text-primary"})}),e.jsx("div",{className:"text-3xl font-bold text-primary mb-1",style:{textShadow:"0 0 20px hsl(var(--primary) / 0.4)"},children:x.total_insights}),e.jsx("div",{className:"text-sm text-[#6B635B]",children:"Total Insights"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 rounded-2xl bg-green-500/10 flex items-center justify-center",children:e.jsx(A,{className:"w-8 h-8 text-green-500"})}),e.jsx("div",{className:"text-3xl font-bold text-green-500 mb-1",style:{textShadow:"0 0 20px rgba(34, 197, 94, 0.4)"},children:x.avg_u_score?.toFixed(1)||"0.0"}),e.jsx("div",{className:"text-sm text-[#6B635B]",children:"Avg U-score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 rounded-2xl bg-blue-500/10 flex items-center justify-center",children:e.jsx(V,{className:"w-8 h-8 text-blue-500"})}),e.jsx("div",{className:"text-3xl font-bold text-blue-500 mb-1",style:{textShadow:"0 0 20px rgba(59, 130, 246, 0.4)"},children:x.total_u_ratings}),e.jsx("div",{className:"text-sm text-[#6B635B]",children:"U-ratings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 rounded-2xl bg-orange-500/10 flex items-center justify-center",children:e.jsx(E,{className:"w-8 h-8 text-orange-500"})}),e.jsx("div",{className:"text-3xl font-bold text-orange-500 mb-1",style:{textShadow:"0 0 20px rgba(249, 115, 22, 0.4)"},children:x.total_continuations}),e.jsx("div",{className:"text-sm text-[#6B635B]",children:"Continuations"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-3 rounded-2xl bg-pink-500/10 flex items-center justify-center",children:e.jsx(k,{className:"w-8 h-8 text-pink-500"})}),e.jsx("div",{className:"text-3xl font-bold text-pink-500 mb-1",style:{textShadow:"0 0 20px rgba(236, 72, 153, 0.4)"},children:x.total_crosslinks}),e.jsx("div",{className:"text-sm text-[#6B635B]",children:"Cross-links"})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-[#6B635B]",children:"No analytics data available"})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"w-16 h-16 text-[#6B635B]/30 mx-auto mb-4"}),e.jsx("p",{className:"text-[#6B635B]",children:"No organization found. Analytics require organization membership."})]})]}),u&&e.jsxs(o,{className:"border-0",padding:"lg",style:{background:"#EAE6E2",boxShadow:"8px 8px 20px rgba(166, 150, 130, 0.3), -8px -8px 20px rgba(255, 255, 255, 0.85)",borderRadius:"24px"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center gap-2 text-[#3A3530]",children:[e.jsx(N,{className:"w-6 h-6 text-blue-500"}),"Organization Approval Requests"]}),e.jsx("p",{className:"text-[#6B635B]",children:"Review and approve organization creation requests"})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:q,disabled:f,children:"Refresh"})]}),f?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(C,{className:"w-10 h-10 text-blue-500 animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-[#6B635B]",children:"Loading organization requests..."})]}):v.length===0?e.jsx("div",{className:"text-center py-8 text-[#6B635B]",children:"No pending organization requests."}):e.jsx("div",{className:"space-y-4",children:v.map(s=>e.jsxs("div",{className:"rounded-xl border border-blue-500/30 p-4 bg-blue-500/5 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-blue-500/20 text-blue-400",children:"Organization"}),e.jsx("span",{className:"text-xs text-[#6B635B]",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[#6B635B]",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:s.status})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.org_name}),s.org_description&&e.jsx("p",{className:"text-sm text-[#6B635B] mb-2",children:s.org_description}),s.reason&&e.jsxs("p",{className:"text-sm italic text-[#6B635B]",children:['"',s.reason,'"']})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-[#6B635B]",children:["User: ",s.user_id.slice(0,8),"..."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{size:"sm",variant:"outline",className:"text-red-500 border-red-500/30 hover:bg-red-500/10",onClick:()=>U(s.id),children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Reject"]}),e.jsxs(r,{size:"sm",onClick:()=>O(s.id),children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Approve"]})]})]})]},s.id))})]}),e.jsxs(o,{className:"border-0",padding:"lg",style:{background:"#EAE6E2",boxShadow:"8px 8px 20px rgba(166, 150, 130, 0.3), -8px -8px 20px rgba(255, 255, 255, 0.85)",borderRadius:"24px"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-[#3A3530]",children:"Top Insights"}),e.jsx("p",{className:"text-[#6B635B]",children:"Best performing content"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:t==="u_score"?"default":"outline",size:"sm",onClick:()=>m("u_score"),className:t==="u_score"?"bg-[#3A3530] text-white hover:bg-[#2A2520]":"text-[#3A3530] border-[#D4CEC5] hover:bg-[#F5F1ED]",style:t==="u_score"?{boxShadow:"4px 4px 8px rgba(166, 150, 130, 0.2), -4px -4px 8px rgba(255, 255, 255, 0.6)"}:{},children:"U-score"}),e.jsx(r,{variant:t==="continuations"?"default":"outline",size:"sm",onClick:()=>m("continuations"),className:t==="continuations"?"bg-[#3A3530] text-white hover:bg-[#2A2520]":"text-[#3A3530] border-[#D4CEC5] hover:bg-[#F5F1ED]",style:t==="continuations"?{boxShadow:"4px 4px 8px rgba(166, 150, 130, 0.2), -4px -4px 8px rgba(255, 255, 255, 0.6)"}:{},children:"Continuations"}),e.jsx(r,{variant:t==="crosslinks"?"default":"outline",size:"sm",onClick:()=>m("crosslinks"),className:t==="crosslinks"?"bg-[#3A3530] text-white hover:bg-[#2A2520]":"text-[#3A3530] border-[#D4CEC5] hover:bg-[#F5F1ED]",style:t==="crosslinks"?{boxShadow:"4px 4px 8px rgba(166, 150, 130, 0.2), -4px -4px 8px rgba(255, 255, 255, 0.6)"}:{},children:"Cross-links"}),e.jsx(r,{variant:t==="recent"?"default":"outline",size:"sm",onClick:()=>m("recent"),className:t==="recent"?"bg-[#3A3530] text-white hover:bg-[#2A2520]":"text-[#3A3530] border-[#D4CEC5] hover:bg-[#F5F1ED]",style:t==="recent"?{boxShadow:"4px 4px 8px rgba(166, 150, 130, 0.2), -4px -4px 8px rgba(255, 255, 255, 0.6)"}:{},children:"Recent"})]})]}),y?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"w-16 h-16 text-primary animate-pulse mx-auto mb-4"}),e.jsx("p",{className:"text-[#6B635B]",children:"Loading insights..."})]}):g&&g.length>0?e.jsx("div",{className:"space-y-4",children:g.map(s=>e.jsx("div",{className:"relative rounded-xl p-6 backdrop-blur-sm border border-[#D4CEC5] hover:border-primary/50 transition-all",style:{background:"#F5F1ED",boxShadow:"inset 2px 2px 5px rgba(166, 150, 130, 0.1), inset -2px -2px 5px rgba(255, 255, 255, 0.5)"},children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 line-clamp-2 text-[#3A3530]",children:s.title||"Untitled Insight"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(A,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-[#6B635B]",children:"U-score:"}),e.jsx("span",{className:"font-medium text-green-500",children:s.u_score_avg?.toFixed(1)||"â€”"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(E,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-[#6B635B]",children:"Continuations:"}),e.jsx("span",{className:"font-medium text-orange-500",children:s.continuations_count||0})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(k,{className:"w-4 h-4 text-pink-500"}),e.jsx("span",{className:"text-[#6B635B]",children:"Cross-links:"}),e.jsx("span",{className:"font-medium text-pink-500",children:s.crosslinks_count||0})]})]})]})})},s.post_id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"w-16 h-16 text-[#6B635B]/30 mx-auto mb-4"}),e.jsx("p",{className:"text-[#6B635B]",children:"No insights yet. Create your first business insight!"})]})]})]})})}export{he as Admin,he as default};
