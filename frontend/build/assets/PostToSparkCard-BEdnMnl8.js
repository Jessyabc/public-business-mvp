import{a as C,a4 as D,r as l,j as t,c as b,u as P,s as j,bb as k}from"./index-DdiXzYE2.js";import{G as A}from"./globe-DhEu-TYx.js";const E=20,N=e=>({...e,viewedAt:new Date().toISOString()}),T=C((e,c)=>({activePostId:null,postsById:{},lastSeen:[],breadcrumbs:[],hoveredPostId:null,recordPosts:n=>{n.length&&e(r=>{const i={...r.postsById};return n.forEach(a=>{i[a.id]=a}),{postsById:i}})},setActivePost:n=>{e(r=>{const i=N(n),a=r.lastSeen.filter(d=>d.id!==n.id),s=r.breadcrumbs.filter(d=>d.id!==n.id);return{activePostId:n.id,postsById:{...r.postsById,[n.id]:n},lastSeen:[i,...a].slice(0,E),breadcrumbs:[...s,i].slice(-12)}})},setActivePostById:n=>{const r=c().postsById[n];r&&c().setActivePost(r)},navigateBreadcrumb:n=>{const r=c();if(n<0||n>=r.breadcrumbs.length)return;const i=r.breadcrumbs[n],a=N(i);e(s=>{const d=s.lastSeen.filter(m=>m.id!==i.id);return{activePostId:i.id,postsById:{...s.postsById,[i.id]:i},lastSeen:[a,...d].slice(0,E),breadcrumbs:s.breadcrumbs.slice(0,n+1)}})},clearBreadcrumbs:()=>e({breadcrumbs:[]}),setHoveredPostId:n=>e({hoveredPostId:n})})),p="#4A7C9B",L=({spark:e,onGiveThought:c,onContinueBrainstorm:n,onSaveReference:r,onView:i})=>{const{lens:a}=D(),s=a==="business",d=e.kind==="BusinessInsight"||e.mode==="business",[m,v]=l.useState(e.t_score),[f,_]=l.useState(e.u_score??null),[g,y]=l.useState(e.view_count),[w,u]=l.useState(!!e.has_given_thought),h=l.useRef(!1);l.useEffect(()=>{h.current||!e.id||(h.current=!0,y(o=>o+1),i?Promise.resolve(i(e.id)):typeof window<"u"&&window.dispatchEvent(new CustomEvent("pb:spark:view",{detail:{sparkId:e.id}})))},[e.id,i]);const x=async()=>{if(!w){u(!0),v(o=>o+1);try{c?await c(e.id,!0):typeof window<"u"&&window.dispatchEvent(new CustomEvent("pb:spark:thought",{detail:{sparkId:e.id}}))}catch{u(!1),v(I=>I-1)}}},S=()=>{if(n){n(e.id);return}typeof window<"u"&&window.dispatchEvent(new CustomEvent("pb:spark:continue",{detail:{sparkId:e.id}}))},B=()=>{if(r){r(e.id);return}typeof window<"u"&&window.dispatchEvent(new CustomEvent("pb:spark:save_reference",{detail:{sparkId:e.id}}))};return t.jsxs("article",{onClick:()=>i?.(e.id),className:b("relative w-full px-6 py-5","transition-all duration-300",i?"cursor-pointer":"",!s&&["bg-transparent","backdrop-blur-xl"],s&&["bg-transparent"]),children:[!s&&t.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-br from-white/6 via-transparent to-[#489FE3]/12 opacity-70"}),t.jsxs("div",{className:"relative z-10",children:[t.jsxs("header",{className:"flex items-start justify-between mb-3",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("div",{className:"text-sm font-medium",style:{color:s?"#3D3833":"white"},children:e.is_anonymous?"Anonymous":e.author_display_name||"Unknown author"})}),t.jsx("time",{className:"text-xs",style:{color:s?"#8B8580":"rgba(255,255,255,0.6)"},children:new Date(e.created_at).toLocaleString()})]}),t.jsxs("div",{className:"mb-4 space-y-2",children:[e.title&&t.jsx("h2",{className:"text-base font-semibold leading-tight",style:{color:s?"#2D2926":"white"},children:e.title}),t.jsx("p",{className:"text-sm leading-relaxed",style:{color:s?"#4D4843":"rgba(255,255,255,0.9)"},children:e.body})]}),t.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[t.jsxs("div",{className:b("inline-flex items-center gap-3 rounded-full px-4 py-1.5","transition-all duration-300",!s&&"backdrop-blur-xl bg-white/8 border border-white/15 shadow-[0_0_12px_rgba(0,0,0,0.25)] hover:bg-white/10"),style:s?{background:"#DDD9D5",boxShadow:"inset 2px 2px 4px rgba(166, 150, 130, 0.2), inset -2px -2px 4px rgba(255, 255, 255, 0.7)"}:void 0,children:[t.jsx("div",{className:"flex items-center gap-1.5",children:d?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-xs font-semibold",style:{color:s?p:"white"},children:f?.toFixed(1)??"—"}),t.jsx("span",{className:"text-[11px]",style:{color:s?"#6B635B":"rgba(255,255,255,0.7)"},children:"U-score"})]}):t.jsx(t.Fragment,{children:t.jsxs("button",{type:"button",onClick:o=>{o.stopPropagation(),x()},className:"flex items-center gap-1 hover:opacity-80 transition-opacity",title:"Give this a thought (T-score)",children:[t.jsx("span",{className:"text-xs font-semibold",style:{color:s?p:"white"},children:m}),t.jsx("span",{className:"text-[11px]",style:{color:s?"#6B635B":"rgba(255,255,255,0.7)"},children:"T-score"})]})})}),t.jsx("div",{className:"w-1 h-1 rounded-full",style:{background:s?"#9B9590":"rgba(255,255,255,0.4)"}}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-xs font-semibold",style:{color:s?p:"white"},children:g}),t.jsx("span",{className:"text-[11px]",style:{color:s?"#6B635B":"rgba(255,255,255,0.7)"},children:"views"})]})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[!d&&t.jsxs("button",{type:"button",onClick:o=>{o.stopPropagation(),x()},className:b("px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap","transition-all duration-200",!s&&(w?"bg-white/15 text-white border border-white/20":"bg-white/5 text-white/80 border border-white/10 hover:bg-white/10 hover:text-white")),style:s?w?{background:`${p}20`,color:p,border:`1px solid ${p}40`,boxShadow:"inset 2px 2px 4px rgba(74, 124, 155, 0.1), inset -2px -2px 4px rgba(255, 255, 255, 0.5)"}:{background:"#E0DCD8",color:"#4D4843",border:"none",boxShadow:"3px 3px 6px rgba(166, 150, 130, 0.25), -3px -3px 6px rgba(255, 255, 255, 0.8)"}:void 0,children:[t.jsx("span",{className:"mr-1.5",children:"✦"}),t.jsx("span",{className:"hidden sm:inline",children:"This made me think"}),t.jsx("span",{className:"sm:hidden",children:"Think"})]}),t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),S()},className:b("px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap","transition-all duration-200",!s&&"bg-white/5 text-white/80 border border-white/10 hover:bg-white/10 hover:text-white"),style:s?{background:"#E0DCD8",color:"#4D4843",border:"none",boxShadow:"3px 3px 6px rgba(166, 150, 130, 0.25), -3px -3px 6px rgba(255, 255, 255, 0.8)"}:void 0,children:"Continue"}),t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),B()},className:b("px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap","transition-all duration-200",!s&&"bg-white/5 text-white/80 border border-white/10 hover:bg-white/10 hover:text-white"),style:s?{background:"#E0DCD8",color:"#4D4843",border:"none",boxShadow:"3px 3px 6px rgba(166, 150, 130, 0.25), -3px -3px 6px rgba(255, 255, 255, 0.8)"}:void 0,children:"Save reference"}),t.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),window.dispatchEvent(new CustomEvent("pb:post:preview",{detail:{postId:e.id}}))},className:b("w-8 h-8 rounded-full flex items-center justify-center","transition-all duration-200",!s&&"bg-white/5 border border-white/10 hover:bg-white/10"),style:s?{background:"#E0DCD8",border:"none",boxShadow:"3px 3px 6px rgba(166, 150, 130, 0.25), -3px -3px 6px rgba(255, 255, 255, 0.8)"}:void 0,title:"Preview",children:t.jsx(A,{className:"w-4 h-4",style:{color:s?"#6B635B":"rgba(255,255,255,0.7)"}})})]})]})]})]})};function U(e,c,n){return{id:e.id,title:e.title||null,body:e.body||e.content,created_at:e.created_at,author_display_name:c||null,author_avatar_url:n||null,is_anonymous:!1,t_score:e.t_score||0,u_score:e.u_score||null,kind:e.kind,mode:e.mode,view_count:e.views_count||0,has_given_thought:e.has_given_thought??!1}}function F({post:e,variant:c="default",showActions:n=!0,metaLabel:r,onSelect:i,authorDisplayName:a}){const[s,d]=l.useState(a??null),[m,v]=l.useState(null),f=T(u=>u.setActivePost),{user:_}=P();l.useEffect(()=>{if(a!==void 0){d(a);return}(async()=>{if(!e.user_id)return;const{data:h}=await j.from("profile_cards").select("display_name").eq("id",e.user_id).maybeSingle();h&&d(h.display_name)})()},[e.user_id,a]),l.useEffect(()=>{const u=async x=>{x.detail.sparkId===e.id&&await j.functions.invoke("interact-post",{body:{post_id:e.id,type:"like"}})},h=async x=>{x.detail.sparkId===e.id&&await j.functions.invoke("interact-post",{body:{post_id:e.id,type:"view"}})};return window.addEventListener("pb:spark:thought",u),window.addEventListener("pb:spark:view",h),()=>{window.removeEventListener("pb:spark:thought",u),window.removeEventListener("pb:spark:view",h)}},[e.id]);const g=U(e,s,m),y=async()=>{if(!_){k({title:"Authentication required",description:"Please sign in to continue this Spark",variant:"destructive"});return}window.dispatchEvent(new CustomEvent("pb:brainstorm:continue",{detail:{parentId:e.id,parentContent:e.content}}))},w=()=>{i?i(e):(f(e),window.dispatchEvent(new CustomEvent("pb:brainstorm:show-thread",{detail:{post:e,postId:e.id}})))};return t.jsxs("div",{className:c==="compact"?"compact-spark-card":"",children:[t.jsx(L,{spark:g,onContinueBrainstorm:y,onView:w}),r&&t.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:r})]})}export{F as P,T as u};
