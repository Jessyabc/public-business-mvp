import{u as b,ap as E,r as i,s as n}from"./index-0gfsL0uy.js";function v(){const{user:t}=b(),{toast:o}=E(),[p,a]=i.useState(!1),[l,c]=i.useState(null),[m,g]=i.useState([]),[y,h]=i.useState([]),f=i.useCallback(async()=>{if(t){a(!0);try{const{data:r,error:e}=await n.from("business_profiles").select(`
          *,
          industry:industries(*),
          department:departments(*)
        `).eq("user_id",t.id).maybeSingle();if(e)throw e;c(r)}catch(r){console.error("Error fetching business profile:",r);let e="Failed to fetch business profile";(r instanceof Error||r&&typeof r=="object"&&"message"in r&&typeof r.message=="string")&&(e=r.message),o({title:"Error",description:e,variant:"destructive"})}finally{a(!1)}}},[t,o]),u=i.useCallback(async()=>{try{const{data:r,error:e}=await n.from("industries").select("*").order("name");if(e)throw e;g(r||[])}catch(r){console.error("Error fetching industries:",r)}},[]),d=i.useCallback(async()=>{try{const{data:r,error:e}=await n.from("departments").select("*").order("name");if(e)throw e;h(r||[])}catch(r){console.error("Error fetching departments:",r)}},[]);return i.useEffect(()=>{t&&(f(),u(),d())},[t,f,u,d]),{profile:l,industries:m,departments:y,loading:p,createProfile:async r=>{if(t){a(!0);try{const{data:e,error:s}=await n.from("business_profiles").insert({user_id:t.id,...r}).select().single();if(s)throw s;return c(e),o({title:"Success",description:"Business profile created successfully"}),e}catch(e){console.error("Error creating business profile:",e);let s="Failed to create business profile";throw(e instanceof Error||e&&typeof e=="object"&&"message"in e&&typeof e.message=="string")&&(s=e.message),o({title:"Error",description:s,variant:"destructive"}),e}finally{a(!1)}}},updateProfile:async r=>{if(!(!t||!l)){a(!0);try{const{data:e,error:s}=await n.from("business_profiles").update(r).eq("user_id",t.id).select().single();if(s)throw s;return c(e),o({title:"Success",description:"Business profile updated successfully"}),e}catch(e){console.error("Error updating business profile:",e);let s="Failed to update business profile";throw(e instanceof Error||e&&typeof e=="object"&&"message"in e&&typeof e.message=="string")&&(s=e.message),o({title:"Error",description:s,variant:"destructive"}),e}finally{a(!1)}}},refetch:f}}export{v as u};
