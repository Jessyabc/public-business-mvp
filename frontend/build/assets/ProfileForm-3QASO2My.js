import{H as q,u as R,t as T,j as e,B as d,bh as V,q as _,ap as X,w as J,v as K,r as i,U as Q,aW as Z,aX as ee,aY as se,c as ae,m as c,at as l,ba as te,a9 as re,au as ie,s as j}from"./index-0gfsL0uy.js";import{C as I,c as U,a as le,b as ne}from"./card-DFvCEgtH.js";import{B as L}from"./BusinessMemberBadge-u69G26EW.js";import{C as oe,a as ce,b as de}from"./collapsible-AzCtvYCW.js";import{L as me}from"./loader-circle-CTU2R_i1.js";import{B as M}from"./building-DZ038TzP.js";import{G as ue}from"./globe-7Ydzx7cL.js";import{S as pe}from"./save-Cyzo7cSc.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=q("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);function he(){const{signOut:n}=R(),t=T(),m=async()=>{try{await n(),_.success("Successfully signed out"),t("/",{replace:!0})}catch(x){console.error("Error signing out:",x),_.error("Failed to sign out")}};return e.jsxs(d,{onClick:m,variant:"outline",className:"w-full transition-all duration-300 bg-red-500/10 hover:bg-red-500/20 text-red-400 border-red-500/30",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Disconnect"]})}function Ce(){const{user:n}=R(),{toast:t}=X(),{userRoles:m,refetch:x}=J(),Y=T(),{profile:h,loading:D,fetchProfile:N,updateProfile:$}=K(),[a,v]=i.useState(null),[w,C]=i.useState(!1),[g,b]=i.useState(!1),[u,k]=i.useState(""),[S,A]=i.useState(!1),[f,B]=i.useState(!1),F=i.useRef(null),p=m.includes("business_member")||m.includes("admin"),H=async s=>{const r=s.target.files?.[0];if(!(!r||!n)){if(!r.type.startsWith("image/")){t({title:"Error",description:"Please upload an image file",variant:"destructive"});return}if(r.size>5*1024*1024){t({title:"Error",description:"Image must be less than 5MB",variant:"destructive"});return}B(!0);try{const y=r.name.split(".").pop(),z=`${Date.now()}.${y}`,E=`${n.id}/${z}`,{error:P}=await j.storage.from("avatars").upload(E,r,{upsert:!0});if(P)throw P;const{data:{publicUrl:G}}=j.storage.from("avatars").getPublicUrl(E);a&&(v({...a,avatar_url:G}),b(!0)),t({title:"Success",description:"Avatar uploaded! Click Save to apply."})}catch(y){console.error("Error uploading avatar:",y),t({title:"Error",description:"Failed to upload avatar",variant:"destructive"})}finally{B(!1)}}};i.useEffect(()=>{h&&v(h)},[h]);const o=(s,r)=>{a&&(v({...a,[s]:r}),b(!0))},O=async()=>{if(!a)return;C(!0);const{error:s}=await $({display_name:a.display_name,avatar_url:a.avatar_url,bio:a.bio,website:a.website,company:a.company,location:a.location,is_completed:!0});C(!1),s?t({title:"Error",description:s.message??"Failed to update profile",variant:"destructive"}):(b(!1),t({title:"Success",description:"Profile updated successfully!"}),await N())},W=async()=>{if(!u.trim()){t({title:"Error",description:"Please enter an invite token",variant:"destructive"});return}A(!0);try{const{error:s}=await j.rpc("consume_invite",{p_token:u.trim()});if(s)throw s;t({title:"Success!",description:"Welcome to Business Membership! You now have access to business features."}),k(""),await x()}catch(s){console.error("Failed to accept invite",s);let r="Failed to accept invite. Please check your token.";(s instanceof Error||s&&typeof s=="object"&&"message"in s&&typeof s.message=="string")&&(r=s.message),t({title:"Error",description:r,variant:"destructive"})}finally{A(!1)}};return D||!a?e.jsx(I,{className:"border-[var(--glass-border)] bg-[var(--glass-bg)] backdrop-blur-[var(--glass-blur)]",children:e.jsx(U,{className:"p-6",children:e.jsx("div",{className:"text-center text-[var(--text-primary)]",children:"Loading profile..."})})}):e.jsxs(I,{className:"border-[var(--glass-border)] bg-[var(--glass-bg)] backdrop-blur-[var(--glass-blur)]",children:[e.jsx(le,{children:e.jsxs(ne,{className:"flex items-center gap-2 text-[var(--text-primary)]",children:[e.jsx(Q,{className:"w-5 h-5 text-[var(--text-secondary)]"}),"Profile Settings"]})}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs(Z,{className:"w-20 h-20",children:[e.jsx(ee,{src:a.avatar_url??void 0}),e.jsx(se,{className:"text-lg bg-primary/20 text-primary",children:a.display_name?.charAt(0)?.toUpperCase()||n?.email?.charAt(0)?.toUpperCase()||"U"})]}),e.jsx("button",{type:"button",onClick:()=>F.current?.click(),disabled:f,className:ae("absolute inset-0 flex items-center justify-center rounded-full","bg-black/50 opacity-0 group-hover:opacity-100","transition-opacity duration-200 cursor-pointer",f&&"opacity-100"),children:f?e.jsx(me,{className:"w-6 h-6 text-white animate-spin"}):e.jsx(xe,{className:"w-6 h-6 text-white"})}),e.jsx("input",{ref:F,type:"file",accept:"image/*",onChange:H,className:"hidden"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(c,{htmlFor:"display_name",className:"text-[var(--text-primary)]",children:"Display Name"}),e.jsx(l,{id:"display_name",value:a.display_name??"",onChange:s=>o("display_name",s.target.value),placeholder:"Your display name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"bio",className:"text-[var(--text-primary)]",children:"Bio"}),e.jsx(l,{as:"textarea",id:"bio",value:a.bio??"",onChange:s=>o("bio",s.target.value),placeholder:"Tell us about yourself..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"company",className:"flex items-center gap-2 text-[var(--text-primary)]",children:[e.jsx(M,{className:"w-4 h-4 text-[var(--text-secondary)]"}),"Company"]}),e.jsx(l,{id:"company",value:a.company??"",onChange:s=>o("company",s.target.value),placeholder:"Your company"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"location",className:"flex items-center gap-2 text-[var(--text-primary)]",children:[e.jsx(te,{className:"w-4 h-4 text-[var(--text-secondary)]"}),"Location"]}),e.jsx(l,{id:"location",value:a.location??"",onChange:s=>o("location",s.target.value),placeholder:"Your location"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"website",className:"flex items-center gap-2 text-[var(--text-primary)]",children:[e.jsx(ue,{className:"w-4 h-4 text-[var(--text-secondary)]"}),"Website / Social Link"]}),e.jsx(l,{id:"website",value:a.website??"",onChange:s=>o("website",s.target.value),placeholder:"https://yourwebsite.com or social profile"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add your website, portfolio, or any social profile link"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{onClick:O,disabled:w||!g,className:"flex-1 transition-all duration-300 bg-primary/20 hover:bg-primary/30 text-primary border border-primary/20 disabled:opacity-50",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-2 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),g?"Save Changes":"No Changes"]})}),g&&e.jsx(d,{variant:"outline",onClick:N,className:"transition-all duration-300 border-white/20 text-foreground hover:bg-white/10",children:"Reset"})]}),e.jsxs(oe,{children:[e.jsxs(ce,{className:"w-full flex items-center justify-between p-4 rounded-lg transition-all duration-300 bg-white/5 border border-white/20 text-foreground hover:bg-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Business Membership"}),p&&e.jsx(L,{})]}),e.jsx("div",{className:`text-xs px-2 py-1 rounded ${p?"bg-green-500/20 text-green-600":"bg-yellow-500/20 text-yellow-600"}`,children:p?"Active":"Invite-Only"})]}),e.jsx(de,{className:"mt-4 space-y-4",children:p?e.jsxs("div",{className:"p-4 rounded-lg bg-green-500/10 border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{}),e.jsx("span",{className:"text-sm font-medium text-green-400",children:"Business Member Active"})]}),e.jsx("p",{className:"text-sm text-green-300",children:"You have access to business features, can create business posts, and send invitations to other users."}),e.jsxs(d,{onClick:()=>Y("/settings?tab=business"),variant:"outline",size:"sm",className:"mt-3 border-green-400/20 text-green-400 hover:bg-green-400/10",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Edit Business Profile"]})]}):e.jsxs("div",{className:"p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20",children:[e.jsx("h4",{className:"font-medium mb-2 text-yellow-400",children:"Business Membership (Invite-Only)"}),e.jsx("p",{className:"text-sm mb-4 text-yellow-300",children:"Business membership is invite-only. If you have an invite token, paste it below to upgrade your account."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{value:u,onChange:s=>k(s.target.value),placeholder:"Paste your invite token here...",className:"flex-1"}),e.jsx(d,{onClick:W,disabled:S||!u.trim(),className:"bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-400 border border-yellow-500/20",children:S?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Accept"]})})]}),e.jsx("p",{className:"text-xs text-yellow-300/80",children:"Need an invite? Ask an existing business member or admin to send you one."})]})]})})]}),e.jsx(he,{})]})]})}export{Ce as P};
