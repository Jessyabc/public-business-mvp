import{u as Z,r as t,s as w,q as I,j as e,aE as K,aF as X,aG as ee,aH as se,g as _,b1 as ae,m as te,o as re,aI as ie,B as T,a5 as ne,I as Y,A as z,aa as G,d as le,a7 as R,z as ce,a8 as oe,h as de,i as ue,k as F,S as U,l as q,C as me}from"./index-DdiXzYE2.js";import{C as pe,a as he,b as xe,d as fe,c as ge}from"./card-CVxPj8sa.js";import{S as B,a as L,b as $,c as H,d as E}from"./select-ZkE_QomC.js";import{rpcApplyToOrg as be}from"./rpc-CPiWz0sY.js";import{L as V}from"./loader-circle-Eg68qUzz.js";import{E as je}from"./external-link-R7IAdm-m.js";import{P}from"./PostToSparkCard-BEdnMnl8.js";import{A as ye}from"./award-y-eAK_R5.js";import"./index-Bzy6S3eG.js";import"./chevron-down-DsrBl0uX.js";import"./globe-DhEu-TYx.js";function ve(){const{user:o}=Z(),[f,h]=t.useState([]),[d,u]=t.useState(!0),i=t.useCallback(async()=>{if(!o){u(!1);return}u(!0);try{const{data:n,error:m}=await w.from("org_member_applications").select(`
          id, org_id, user_id, message, status, reviewed_by, reviewed_at, created_at, updated_at
        `).eq("user_id",o.id).order("created_at",{ascending:!1});if(m)throw m;const r=n||[];if(r.length>0){const g=Array.from(new Set(r.map(l=>l.org_id))),{data:p}=await w.from("orgs").select("id, name, description, website, status").in("id",g),j=new Map((p||[]).map(l=>[l.id,l]));r.forEach(l=>{l.org=j.get(l.org_id)})}h(r)}catch(n){console.error("Error fetching applications:",n),I.error("Failed to load applications")}finally{u(!1)}},[o]);return t.useEffect(()=>{i()},[i]),{applications:f,loading:d,applyToOrg:async(n,m)=>{if(!o){I.error("You must be logged in to apply");return}try{const{error:r}=await be(n,m||null);if(r)throw r;I.success("Application submitted successfully!"),await i()}catch(r){throw console.error("Error applying to org:",r),I.error(r.message||"Failed to submit application"),r}},refetch:i}}function Ne({org:o,isOpen:f,onClose:h,onSubmit:d}){const[u,i]=t.useState(""),[c,n]=t.useState(!1),m=async r=>{r.preventDefault(),n(!0);try{await d(u.trim()||void 0),i("")}finally{n(!1)}};return e.jsx(K,{open:f,onOpenChange:h,children:e.jsxs(X,{className:"sm:max-w-[500px]",children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-primary"}),"Apply to ",o.name]}),e.jsx(ae,{children:"Submit an application to join this organization. The organization owner will review your request."})]}),e.jsxs("form",{onSubmit:m,children:[e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx(te,{htmlFor:"message",children:"Message (Optional)"}),e.jsx(re,{id:"message",value:u,onChange:r=>i(r.target.value),placeholder:"Tell the organization why you'd like to join...",className:"min-h-[100px] mt-2"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional: Add a message to introduce yourself"})]})}),e.jsxs(ie,{children:[e.jsx(T,{type:"button",variant:"outline",onClick:h,disabled:c,children:"Cancel"}),e.jsx(T,{type:"submit",disabled:c,children:c?"Submitting...":"Submit Application"})]})]})]})})}const we={"1-10":"1-10 employees","11-50":"11-50 employees","51-200":"51-200 employees","201-1000":"201-1000 employees","1000+":"1000+ employees"};function _e({searchQuery:o="",onSearchChange:f}){const[h,d]=t.useState([]),[u,i]=t.useState(!0),[c,n]=t.useState("all"),[m,r]=t.useState([]),[g,p]=t.useState(null),[j,l]=t.useState(!1),{applyToOrg:S}=ve(),{data:O}=ne(),[x,k]=t.useState(o),M=O?.map(a=>a.org_id)||[];t.useEffect(()=>{(async()=>{const{data:v,error:b}=await w.from("industries").select("id, name").order("name");b?console.error("Error fetching industries:",b):r(v||[])})()},[]);const s=t.useCallback(async()=>{i(!0);try{let a=w.from("orgs").select("id, name, description, website, industry_id, company_size, status").eq("status","approved").order("name",{ascending:!0});x.trim()&&(a=a.or(`name.ilike.%${x}%,description.ilike.%${x}%`)),c!=="all"&&(a=a.eq("industry_id",c));const{data:v,error:b}=await a;if(b)throw b;const A=v||[];if(A.length>0){const Q=Array.from(new Set(A.map(D=>D.industry_id).filter(Boolean)));if(Q.length>0){const{data:D}=await w.from("industries").select("id, name").in("id",Q),W=new Map((D||[]).map(N=>[N.id,N]));A.forEach(N=>{N.industry_id&&(N.industry=W.get(N.industry_id))})}}d(A)}catch(a){console.error("Error fetching organizations:",a)}finally{i(!1)}},[x,c]);t.useEffect(()=>{s()},[s]),t.useEffect(()=>{f&&f(x)},[x,f]);const y=a=>{p(a),l(!0)},C=async a=>{if(g)try{await S(g.id,a),l(!1),p(null),await s()}catch{}},J=a=>M.includes(a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Y,{placeholder:"Search companies by name or description...",value:x,onChange:a=>k(a.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})}),e.jsxs(B,{value:c,onValueChange:n,children:[e.jsx(L,{className:"w-48 bg-background border-input text-foreground",children:e.jsx($,{placeholder:"Filter by industry"})}),e.jsxs(H,{children:[e.jsx(E,{value:"all",children:"All Industries"}),m.map(a=>e.jsx(E,{value:a.id,children:a.name},a.id))]})]})]}),u?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-8 h-8 animate-spin text-primary"})}):h.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-muted border border-border",children:e.jsx(_,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:"No companies found"})]}):e.jsx("div",{className:"grid gap-4",children:h.map((a,v)=>{const b=J(a.id);return e.jsxs(pe,{className:"rounded-2xl overflow-hidden backdrop-blur-xl transition-all duration-300 animate-feed-card-enter bg-card border border-border shadow-sm hover:shadow-md hover:border-border/80",style:{animationDelay:`${v*50}ms`},children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-primary"}),a.name]}),a.website&&e.jsx(fe,{className:"mt-1",children:e.jsxs("a",{href:a.website.startsWith("http")?a.website:`https://${a.website}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-primary hover:underline",children:[a.website,e.jsx(je,{className:"h-3 w-3"})]})})]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[a.industry&&e.jsx(z,{variant:"secondary",children:a.industry.name}),a.company_size&&e.jsxs(z,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),we[a.company_size]||a.company_size]})]})]})}),a.description&&e.jsxs(ge,{children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:a.description}),b&&e.jsx("div",{className:"mt-4",children:e.jsx(z,{variant:"default",children:"You are a member"})}),!b&&e.jsx("div",{className:"mt-4",children:e.jsx(T,{onClick:()=>y(a),variant:"default",size:"sm",children:"Apply to Join"})})]})]},a.id)})}),j&&g&&e.jsx(Ne,{org:g,isOpen:j,onClose:()=>{l(!1),p(null)},onSubmit:C})]})}const Fe=()=>{const{isOpen:o,openComposer:f,closeComposer:h}=le(),[d,u]=t.useState("sparks"),[i,c]=t.useState(""),[n,m]=t.useState("recent"),[r,g]=t.useState("all"),[p,j]=t.useState([]),[l,S]=t.useState(!1),O=[{value:"recent",label:"Most Recent",icon:ce},{value:"t_score",label:"T-Score",icon:oe},{value:"u_score",label:"U-Score",icon:ye}],x=[{value:"all",label:"All Industries"},{value:"technology",label:"Technology"},{value:"healthcare",label:"Healthcare"},{value:"finance",label:"Finance"},{value:"manufacturing",label:"Manufacturing"},{value:"education",label:"Education"},{value:"marketing",label:"Marketing"}],k=async()=>{S(!0);try{let s=w.from("posts").select("id, title, content, created_at, type, u_score, t_score, industry_id").eq("status","active").eq("visibility","public");d==="sparks"?s=s.eq("type","brainstorm"):d==="insights"&&(s=s.eq("type","insight")),i&&(s=s.or(`title.ilike.%${i}%,content.ilike.%${i}%`)),n==="recent"?s=s.order("created_at",{ascending:!1}):n==="t_score"?s=s.order("t_score",{ascending:!1,nullsFirst:!1}):n==="u_score"&&(s=s.order("u_score",{ascending:!1,nullsFirst:!1})),s=s.limit(20);const{data:y,error:C}=await s;if(C)throw C;j(y||[])}catch(s){console.error("Error fetching research data:",s),j([])}finally{S(!1)}};t.useEffect(()=>{k()},[d,n,r]);const M=s=>{s.preventDefault(),k()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen p-6 pb-32 transition-colors duration-300 bg-background",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("header",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-2",children:[e.jsx(R,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-4xl font-light tracking-wide text-foreground",children:"Research Hub"})]}),e.jsx("p",{className:"font-light max-w-2xl mx-auto text-muted-foreground",children:"Explore sparks, business insights, and companies"})]}),e.jsx("div",{className:"mb-8 p-4 rounded-2xl backdrop-blur-xl bg-card border border-border shadow-sm",children:e.jsxs("form",{onSubmit:M,className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Y,{placeholder:"Search for insights, sparks, or topics...",value:i,onChange:s=>c(s.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{value:n,onValueChange:m,children:[e.jsx(L,{className:"w-40 bg-background border-input text-foreground",children:e.jsx($,{placeholder:"Sort by"})}),e.jsx(H,{children:O.map(s=>e.jsx(E,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),s.label]})},s.value))})]}),e.jsxs(B,{value:r,onValueChange:g,children:[e.jsx(L,{className:"w-40 bg-background border-input text-foreground",children:e.jsx($,{placeholder:"Industry"})}),e.jsx(H,{children:x.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))})]}),e.jsx(T,{type:"submit",className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:e.jsx(R,{className:"h-4 w-4"})})]})]})}),e.jsxs(de,{value:d,onValueChange:u,className:"space-y-6",children:[e.jsxs(ue,{className:"grid w-full grid-cols-3 backdrop-blur-xl bg-muted border border-border",children:[e.jsxs(F,{value:"sparks",className:"flex items-center gap-2 data-[state=active]:bg-background",children:[e.jsx(U,{className:"h-4 w-4"}),"Sparks"]}),e.jsxs(F,{value:"insights",className:"flex items-center gap-2 data-[state=active]:bg-background",children:[e.jsx(_,{className:"h-4 w-4"}),"Business Insights"]}),e.jsxs(F,{value:"companies",className:"flex items-center gap-2 data-[state=active]:bg-background",children:[e.jsx(G,{className:"h-4 w-4"}),"Companies"]})]}),e.jsx(q,{value:"sparks",className:"mt-0",children:e.jsx("div",{className:"min-h-[400px]",children:l?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-8 h-8 animate-spin text-primary"})}):p.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-muted border border-border",children:e.jsx(U,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:"No sparks found"})]}):e.jsx("div",{className:"grid gap-4",children:p.map((s,y)=>e.jsx("div",{className:"rounded-2xl overflow-hidden backdrop-blur-xl transition-all duration-300 animate-feed-card-enter bg-card border border-border shadow-sm hover:shadow-md hover:border-border/80",style:{animationDelay:`${y*50}ms`},children:e.jsx(P,{post:{id:s.id,title:s.title,content:s.content,created_at:s.created_at,updated_at:s.created_at,type:s.type,kind:"Spark",user_id:"",mode:"public",status:"active",visibility:"public",metadata:null,likes_count:0,comments_count:0,views_count:0,t_score:s.t_score,u_score:s.u_score}})},s.id))})})}),e.jsx(q,{value:"insights",className:"mt-0",children:e.jsx("div",{className:"min-h-[400px]",children:l?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-8 h-8 animate-spin text-primary"})}):p.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-muted border border-border",children:e.jsx(_,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:"No insights found"})]}):e.jsx("div",{className:"grid gap-4",children:p.map((s,y)=>e.jsx("div",{className:"rounded-2xl overflow-hidden backdrop-blur-xl transition-all duration-300 animate-feed-card-enter bg-card border border-border shadow-sm hover:shadow-md hover:border-border/80",style:{animationDelay:`${y*50}ms`},children:e.jsx(P,{post:{id:s.id,title:s.title,content:s.content,created_at:s.created_at,updated_at:s.created_at,type:s.type,kind:"BusinessInsight",user_id:"",mode:"business",status:"active",visibility:"public",metadata:null,likes_count:0,comments_count:0,views_count:0,t_score:s.t_score,u_score:s.u_score}})},s.id))})})}),e.jsx(q,{value:"companies",className:"mt-0",children:e.jsx("div",{className:"min-h-[400px]",children:e.jsx(_e,{searchQuery:i,onSearchChange:c})})})]})]})}),e.jsx(me,{isOpen:o,onClose:h})]})};export{Fe as default};
