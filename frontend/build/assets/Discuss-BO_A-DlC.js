import{r as s,j as e,c as a,S as M,a as B,p as A,B as k,T as O,b as D,d as F,e as z,s as q,f as K,g as Y,L as $,C as H}from"./index-DdiXzYE2.js";import{P as X,F as G}from"./PullToRefresh-CddkLDZe.js";import{C as J}from"./compass-BCDqVw1y.js";import{u as j}from"./PostToSparkCard-BEdnMnl8.js";import{P as Q}from"./PostReaderModal-Btyl2ffZ.js";import{B as U}from"./bell-CdK3GNew.js";import"./arrow-right-CyP0_zRv.js";import"./chevron-down-DsrBl0uX.js";import"./loader-circle-Eg68qUzz.js";import"./globe-DhEu-TYx.js";import"./lightbulb-DxkdnT7p.js";import"./arrow-left-DwcmxzYb.js";function V({main:n,crossLinks:o,sidebar:c,className:u}){const[d,r]=s.useState("main"),h=[{id:"main",label:"Feed",icon:M},{id:"sidebar",label:"Trail",icon:J}];return e.jsxs("div",{className:a("flex h-full flex-col",u),children:[e.jsx("div",{className:"lg:hidden px-4 pt-3 pb-2",children:e.jsxs("div",{className:"relative rounded-2xl bg-white/10 backdrop-blur-md p-1.5 border border-white/20 shadow-lg",children:[e.jsx("div",{className:a("absolute top-1.5 bottom-1.5 w-[calc(50%-6px)] rounded-xl bg-white/20 backdrop-blur transition-transform duration-300 ease-out","shadow-[0_0_15px_rgba(72,159,227,0.3)]",d==="sidebar"?"translate-x-[calc(100%+6px)]":"translate-x-0")}),e.jsx("div",{className:"relative grid grid-cols-2 gap-1",children:h.map(i=>{const N=i.icon,m=d===i.id;return e.jsxs("button",{type:"button",onClick:()=>r(i.id),className:a("relative z-10 flex items-center justify-center gap-2.5 rounded-xl px-4 py-2.5 text-sm font-semibold transition-all duration-200",m?"text-white":"text-white/50 hover:text-white/70"),children:[e.jsx(N,{className:a("w-4 h-4",m&&"drop-shadow-[0_0_6px_rgba(255,255,255,0.5)]")}),e.jsx("span",{className:"uppercase tracking-[0.15em]",children:i.label})]},i.id)})})]})}),e.jsxs("div",{className:"hidden h-full min-h-0 gap-6 lg:grid lg:grid-cols-[minmax(0,1fr)_minmax(220px,280px)] px-4 py-4",children:[e.jsx("div",{className:"min-h-0",children:n}),e.jsx("div",{className:"min-h-0",children:c})]}),e.jsxs("div",{className:"flex-1 overflow-hidden lg:hidden",children:[d==="main"&&e.jsx("div",{className:"h-full overflow-auto",children:n}),d==="sidebar"&&e.jsx("div",{className:"h-full overflow-auto p-4",children:c})]})]})}const W=20,Z=B()(A(n=>({trail:[],addToTrail:o=>n(c=>{const u=c.trail.filter(r=>r.id!==o.id);return{trail:[{...o,visitedAt:new Date().toISOString()},...u].slice(0,W)}}),clearTrail:()=>n({trail:[]}),removeFromTrail:o=>n(c=>({trail:c.trail.filter(u=>u.id!==o)}))}),{name:"pb-trail-store",version:1}));function ee({variant:n="default",onSelectPost:o}){const{trail:c,addToTrail:u,clearTrail:d}=Z();return s.useEffect(()=>{const r=h=>{h.detail.post&&u({id:h.detail.post.id,title:h.detail.post.title||null,content:h.detail.post.content})};return window.addEventListener("pb:brainstorm:show-thread",r),()=>{window.removeEventListener("pb:brainstorm:show-thread",r)}},[u]),n==="feed"?c.length===0?e.jsxs("div",{className:a("h-full overflow-y-auto rounded-2xl p-4","bg-black/30 backdrop-blur-sm","border border-white/10","shadow-[inset_0_0_30px_rgba(72,159,227,0.05)]"),children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-sm font-semibold text-white/80 uppercase tracking-wider",children:"Your Trail"})}),e.jsx("p",{className:"text-sm text-white/50 text-center py-8",children:"Posts you view will appear here as breadcrumbs."})]}):e.jsxs("div",{className:a("h-full overflow-y-auto rounded-2xl p-4","bg-black/30 backdrop-blur-sm","border border-white/10","shadow-[inset_0_0_30px_rgba(72,159,227,0.05)]"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-white/80 uppercase tracking-wider",children:"Your Trail"}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:d,className:"text-white/40 hover:text-white/70 h-6 px-2",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"Clear"]})]}),e.jsx("ol",{className:"space-y-3",children:c.map((r,h)=>e.jsxs("li",{className:"flex items-start gap-3 text-left group",children:[e.jsx("span",{className:a("mt-1 inline-flex h-7 w-7 items-center justify-center rounded-full","bg-gradient-to-br from-white/20 to-white/5","border border-white/20","font-semibold text-white/80 text-center text-xs","shadow-[0_0_10px_rgba(72,159,227,0.2)]","group-hover:shadow-[0_0_15px_rgba(72,159,227,0.4)]","transition-all duration-300"),children:h+1}),e.jsx("button",{onClick:()=>o?.(r.id),className:"flex-1 text-left group/card",children:e.jsxs("div",{className:a("p-3 rounded-xl","bg-white/5 backdrop-blur-sm","border border-white/10","hover:bg-white/10 hover:border-white/20","hover:shadow-[0_0_20px_rgba(72,159,227,0.15)]","transition-all duration-300 cursor-pointer"),children:[r.title&&e.jsx("p",{className:"text-sm font-semibold text-white/90 mb-1 line-clamp-1",children:r.title}),e.jsx("p",{className:"text-xs text-white/60 line-clamp-2",children:r.content}),e.jsx("p",{className:"mt-2 text-[10px] uppercase tracking-[0.2em] text-white/40",children:new Date(r.visitedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})]},r.id))})]}):null}function te(){const[n,o]=D(),[c,u]=s.useState(!1);j(t=>t.activePostId);const{openComposer:d,closeComposer:r,isOpen:h}=F(),{lens:i,toggleLens:N}=z(),[m,P]=s.useState(null),[se,w]=s.useState(null),[S,I]=s.useState(!0),[C,E]=s.useState(0),y=s.useRef(!1),[_,f]=s.useState(null),v=s.useRef(!1);c||(j.setState({activePostId:null}),u(!0));const L=async()=>{E(t=>t+1)};s.useEffect(()=>{P(null),w(null),f(null),r(),v.current=!1;const t=setTimeout(()=>{v.current=!0},100);return j.getState().activePostId&&j.setState({activePostId:null}),()=>clearTimeout(t)},[i,r]),s.useEffect(()=>{j.setState({activePostId:null}),f(null),w(null),P(null),n.get("post")&&o({},{replace:!0});const l=setTimeout(()=>{v.current=!0,I(!1)},100);return()=>clearTimeout(l)},[]);const b=s.useCallback(async t=>{if(y.current)return null;y.current=!0;try{const{data:l,error:p}=await q.from("posts").select("*").eq("id",t).eq("status","active").single();if(p)throw p;return l}catch(l){return console.error("Error fetching post:",l),null}finally{y.current=!1}},[]);s.useEffect(()=>{const t=l=>{const{parentId:p,sparkId:T}=l.detail||{},g=p||T;g?d({parentPostId:g,relationType:"continuation"}):d()};return window.addEventListener("pb:brainstorm:continue",t),window.addEventListener("pb:spark:continue",t),()=>{window.removeEventListener("pb:brainstorm:continue",t),window.removeEventListener("pb:spark:continue",t)}},[d]),s.useEffect(()=>{const t=async l=>{if(!v.current||S)return;const{postId:p,post:T}=l.detail;if(T)f(T);else if(p){const g=await b(p);g&&f(g)}};return window.addEventListener("pb:brainstorm:show-thread",t),()=>window.removeEventListener("pb:brainstorm:show-thread",t)},[b,S]),s.useEffect(()=>{if(!v.current||S)return;const t=n.get("post");t&&(b(t).then(l=>{l&&f(l)}),o({},{replace:!0}))},[n,o,S,b]),s.useEffect(()=>{if(!m){w(null);return}b(m).then(t=>{t?w(t):(w(null),P(null))})},[m,b]);const R=s.useCallback(t=>{m!==t&&P(t)},[m]),x=i==="public";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:a("relative z-10 flex items-center justify-between px-4 py-3 lg:px-6",x?"text-white":"text-slate-800"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:a("text-lg font-semibold",x?"text-white/90":"text-slate-800"),children:"Discuss"}),e.jsxs("div",{className:a("flex items-center rounded-full p-0.5 border",x?"bg-white/10 border-white/20":"bg-slate-100 border-slate-200"),children:[e.jsxs("button",{onClick:()=>i!=="public"&&N(),className:a("flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium transition-all",i==="public"?"bg-primary text-white":x?"text-white/60 hover:text-white/80":"text-slate-500 hover:text-slate-700"),children:[e.jsx(K,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Public"})]}),e.jsxs("button",{onClick:()=>i!=="business"&&N(),className:a("flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium transition-all",i==="business"?"bg-blue-600 text-white":x?"text-white/60 hover:text-white/80":"text-slate-500 hover:text-slate-700"),children:[e.jsx(Y,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Business"})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx($,{to:"/notifications",children:e.jsxs(k,{variant:"ghost",size:"icon",className:a("relative w-10 h-10 rounded-full transition-all duration-200",x?"bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 text-white/70 hover:text-white":"bg-slate-100 hover:bg-slate-200 border border-slate-200 text-slate-600 hover:text-slate-800"),children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{className:a("absolute top-2 right-2 w-2 h-2 rounded-full animate-pulse",x?"bg-[var(--accent)]":"bg-blue-500")})]})})})]}),e.jsx(X,{onRefresh:L,children:e.jsx(V,{main:e.jsx(G,{mode:i==="business"?"business":"public",activePostId:null},`${C}-${i}`),crossLinks:null,sidebar:e.jsx(ee,{variant:"feed",onSelectPost:R})})}),e.jsx(H,{isOpen:h,onClose:r}),e.jsx(Q,{isOpen:!!_,onClose:()=>f(null),post:_})]})}function pe(){return e.jsx(te,{})}export{pe as default};
